<div class="container" fxFlexFill>
  <div fxLayout="row" >
    <mat-card class="card"  >
     <!--
     <mat-card-title fxLayout.gt-xs="row" fxLayout.xs="column">
        <h5 class="headers-color"> {{participantType === 1 ?  'الطرف الأول' : 'الطرف الثاني'}}</h5>
      </mat-card-title>
       -->

      <mat-card-content>
        <form [formGroup]="procurationCustomer" novalidate autocomplete="off">
          <div class="mat-elevation-z8 card-content-space-around" fxLayout="column" fxLayoutGap="1%"  fxLayoutAlign="center">

            <div fxLayout="row wrap" fxLayout.xs="column" fxLayoutAlign="start center" fxLayoutGap="10%" formGroupName="customer">

              <mat-form-field class="input-width">
                <mat-label >الصفه</mat-label>
                <mat-select   formControlName="customerCategory">
                  <mat-option *ngFor="let cg of (requestCustomerTypes$ | async)" [value]="cg.id">{{cg.description}}</mat-option>
                </mat-select>
                <mat-error *ngFor="let type of (validationTypes$ | async)">
                  <mat-error *ngIf="getFormControlCustomer('customerCategory').hasError(type) && (getFormControlCustomer('customerCategory').dirty || getFormControlCustomer('customerCategory').touched)">{{validationMessagesService.getValidatorErrorMessage(type, null, 'الصفه')}}</mat-error>
                </mat-error>
              </mat-form-field>

              <mat-form-field class="input-width">
                <mat-label >نوع الوثيفه</mat-label>
                <mat-select  formControlName="customerIDType">
                  <mat-option *ngFor="let cId of (customerIdTypes$ | async)" [value]="cId.id">{{cId.description}}</mat-option>
                </mat-select>
                <mat-error *ngFor="let type of (validationTypes$ | async)">
                  <mat-error *ngIf="getFormControlCustomer('customerIDType').hasError(type) && (getFormControlCustomer('customerIDType').dirty
                   || getFormControlCustomer('customerIDType').touched)">{{validationMessagesService.getValidatorErrorMessage(type, null, 'نوع الوثيفه')}}</mat-error>
                </mat-error>
              </mat-form-field>

              <mat-form-field class="input-width">
                <mat-label>الرقم المدني</mat-label>
                <input matInput type="number" formControlName="customerCivilId" [maxLength]="maxLength" appInputLimiter="maxLength">
                <mat-error *ngFor="let type of (validationTypes$ | async)">
                  <mat-error *ngIf="getFormControlCustomer('customerCivilId').hasError(type) && (getFormControlCustomer('customerCivilId').dirty || getFormControlCustomer('customerCivilId').touched)">{{validationMessagesService.getValidatorErrorMessage(type, {max: maxLength, min: 1}, 'الرقم المدني')}}</mat-error>
                </mat-error>
              </mat-form-field>

              <mat-form-field class="input-width" *ngIf="getFormControlCustomerValue('customerIDType') === 1">
                <mat-label>الصلاحيه</mat-label>
                <input matInput [matDatepicker]="dp2" (dateChange)="onChangesExpiryDate($event)" formControlName="idExpiryDate">
                <mat-datepicker-toggle matSuffix [for]="dp2"></mat-datepicker-toggle>
                <mat-datepicker #dp2></mat-datepicker>
                <mat-error *ngFor="let type of (validationTypes$ | async)">
                  <mat-error *ngIf="getFormControlCustomer('idExpiryDate').hasError(type) && (getFormControlCustomer('idExpiryDate').dirty
                   || getFormControlCustomer('idExpiryDate').touched)">{{validationMessagesService.getValidatorErrorMessage(type, null, 'الصلاحيه')}}</mat-error>
                </mat-error>
              </mat-form-field>

              <mat-form-field class="input-width">
                <mat-label>الاسم كامل</mat-label>
                <input matInput formControlName="customerName">
                <mat-hint align="start"><strong>الاسم يتكون من مقطعين علي الأقل</strong> </mat-hint>
                <mat-error *ngFor="let type of (validationTypes$ | async)">
                  <mat-error *ngIf="getFormControlCustomer('customerName').hasError(type) && (getFormControlCustomer('customerName').dirty
                   || getFormControlCustomer('customerName').touched)">{{validationMessagesService.getValidatorErrorMessage(type, null, 'الاسم كامل')}}</mat-error>
                </mat-error>
              </mat-form-field>

              <mat-form-field class="input-width">
                <mat-label> رقم النقال</mat-label>
                <input matInput type="tel" formControlName="mobileNo">
                <mat-error *ngFor="let type of (validationTypes$ | async)">
                  <mat-error *ngIf="getFormControlCustomer('mobileNo').hasError(type) && (getFormControlCustomer('mobileNo').dirty
                   || getFormControlCustomer('mobileNo').touched)">{{validationMessagesService.getValidatorErrorMessage(type, {max: 15, min: 8}, 'الرقم المدني')}}</mat-error>
                </mat-error>
              </mat-form-field>


                <mat-form-field class="input-width" *appInputPerPage="transactionCategories.marriageAndDivorceTransactions">
                  <mat-label>العنوان</mat-label>
                  <input matInput formControlName="address">
                </mat-form-field>


              <mat-form-field class="input-width">
                <mat-label > الجنسيه</mat-label>
                <mat-select   formControlName="nationality">
                  <mat-option *ngFor="let n of (nationalities$ | async)" [value]="n.id">{{n.description}}</mat-option>
                </mat-select>
              </mat-form-field>

              <mat-form-field class="input-width" *appInputPerPage="transactionCategories.marriageAndDivorceTransactions">
                <mat-label>تاريخ الميلاد</mat-label>
                <input matInput [matDatepicker]="dp" placeholder="Different locale" (dateChange)="onChangesBirthDate($event)" formControlName="birthDate">
                <mat-datepicker-toggle matSuffix [for]="dp"></mat-datepicker-toggle>
                <mat-datepicker #dp></mat-datepicker>
              </mat-form-field>

              <mat-form-field class="input-width" *ngIf="false">
                <mat-label>القبيله</mat-label>
                <input matInput formControlName="tribeName">
              </mat-form-field>

              <mat-form-field class="input-width" *appInputPerPage="transactionCategories.marriageAndDivorceTransactions">
                <mat-label > المؤهل الدراسي</mat-label>
                <mat-select   formControlName="qualificationId">
                  <mat-option *ngFor="let qualification of (adminTypes$ | async) | adminTypes: 2" [value]="qualification.Id">{{qualification.NameAr}}</mat-option>
                </mat-select>
              </mat-form-field>

              <mat-form-field class="input-width" *ngIf="false">
                <mat-label > المهنه</mat-label>
                <mat-select   formControlName="professionId">
                  <mat-option *ngFor="let qualification of (adminTypes$ | async) | adminTypes: 1" [value]="qualification.Id">{{qualification.NameAr}}</mat-option>
                </mat-select>
              </mat-form-field>

              <mat-form-field class="input-width" *appInputPerPage="transactionCategories.marriageAndDivorceTransactions">
                <mat-label > حالة العمل</mat-label>
                <mat-select   formControlName="workStatusId">
                  <mat-option *ngFor="let qualification of (adminTypes$ | async) | adminTypes: 3" [value]="qualification.Id">{{qualification.NameAr}}</mat-option>
                </mat-select>
              </mat-form-field>

              <ng-template *appInputPerPage="transactionCategories.marriageTransactions">
              <mat-form-field class="input-width" *ngIf="getFormControlCustomerValue('customerIDType') !== 1">
                <mat-label>رقم موافقه السفاره</mat-label>
                <input matInput formControlName="embassyDocNo">
              </mat-form-field>

              <mat-form-field class="input-width" *ngIf="getFormControlCustomerValue('customerIDType') !== 1">
                <mat-label>تاريخ موافقة السفاره</mat-label>
                <input matInput [matDatepicker]="embassy" placeholder="Different locale" (dateChange)="onChangesEmbassyDate($event)" formControlName="embassyDocDate">
                <mat-datepicker-toggle matSuffix [for]="embassy"></mat-datepicker-toggle>
                <mat-datepicker #embassy></mat-datepicker>
              </mat-form-field>
              </ng-template>

              <ng-template *appInputPerPage="transactionCategories.lawyerTransactions">
              <mat-form-field class="input-width" *ngIf="participantType === 2">
                <mat-label > مكتب المحاماه</mat-label>
                <mat-select   >
                  <mat-option ></mat-option>
                </mat-select>
              </mat-form-field>
              </ng-template>

            </div>


            <div fxLayout="row wrap" fxLayout.xs="column" fxLayoutWrap fxLayoutGap="10%" fxLayoutAlign="start center" formGroupName="facilityData"
                 *ngIf="getFormControlCustomerValue('customerCategory') === 55 ||
                        getFormControlCustomerValue('customerCategory') === 64 ||
                        getFormControlCustomerValue('customerCategory') === 6">

              <mat-form-field class="input-width" *ngIf="false">
                <mat-label> رقم المنشأه</mat-label>
                <input matInput formControlName="facilityNo">
              </mat-form-field>

              <mat-form-field class="input-width" *ngIf="false">
                <mat-label> اسم المنشأه</mat-label>
                <input matInput formControlName="facilityName">
              </mat-form-field>

              <mat-form-field class="input-width">
                <mat-label> السجل التجاري</mat-label>
                <input matInput formControlName="commericalRegister">
              </mat-form-field>

              <mat-form-field class="input-width" >
                <mat-label> اسم الشركه</mat-label>
                <input matInput formControlName="facilityName">
              </mat-form-field>

              <mat-form-field class="input-width">
                <mat-label> صندوق البريد</mat-label>
                <input matInput formControlName="postalBox">
              </mat-form-field>

              <mat-form-field class="input-width">
                <mat-label> رقم تليفون الشركه</mat-label>
                <input type="tel" matInput formControlName="telephone">
              </mat-form-field>

              <mat-form-field class="input-width">
                <mat-label>تاريخ الإنتهاء</mat-label>
                <input matInput [matDatepicker]="expire" placeholder="Different locale" (dateChange)="onChangesCompanyExpiryDate($event)" formControlName="expiryDate">
                <mat-datepicker-toggle matSuffix [for]="expire"></mat-datepicker-toggle>
                <mat-datepicker #expire></mat-datepicker>
              </mat-form-field>

            </div>


            <div fxLayout="row wrap" fxLayout.xs="column" fxLayoutWrap fxLayoutGap="10%" fxLayoutAlign="start center" formGroupName="procuration">

              <mat-radio-group fxLayout="row"  fxLayoutWrap fxLayoutGap="20%" fxLayoutAlign="start center"
                               formControlName="manualFlag" *ngIf="getFormControlCustomerValue('customerCategory') === 7 ||
                                                                   getFormControlCustomerValue('customerCategory') === 1">
                <mat-radio-button class="example-radio-button" [value]="true">
                 {{getFormControlCustomerValue('customerCategory') === 7 ? 'تفويض يدوي' : 'وكالة يدوية'}}
                </mat-radio-button>
                <mat-radio-button class="example-radio-button" [value]="false">
                  {{getFormControlCustomerValue('customerCategory') === 7 ? 'تفويض آلي' : 'وكالة آلية'}}
                </mat-radio-button>
              </mat-radio-group>

              <mat-form-field class="input-width" *ngIf="getFormControlCustomerValue('customerCategory') === 7 ||
                        getFormControlCustomerValue('customerCategory') === 1 ||
                        getFormControlCustomerValue('customerCategory') === 3 ||
                        getFormControlCustomerValue('customerCategory') === 74">
                <mat-label>{{getFormControlCustomerValue('customerCategory') === 7 ? 'رقم التفويض' :
                getFormControlCustomerValue('customerCategory') === 1? 'رقم الوكاله' : 'رقم الخطاب'}}</mat-label>
                <input matInput [formControlName]="getFormControlProcurationValue('manualFlag') === true? 'procurationNote': 'repProcurationSerial'">
              </mat-form-field>

              <mat-form-field class="input-width" *ngIf="getFormControlCustomerValue('customerCategory') === 3 ||
                                                         getFormControlCustomerValue('customerCategory') === 74">
                <mat-label>جهة الخطاب</mat-label>
                <input matInput formControlName="issuer">
              </mat-form-field>


            </div>

            <div fxLayout="row wrap" fxLayout.xs="column" fxLayoutWrap fxLayoutGap="10%" fxLayoutAlign="start center">
                <mat-checkbox formControlName="requesterFlag" >مقدم الطلب</mat-checkbox>
            </div>

            </div>
        </form>
      </mat-card-content>

      <mat-card-actions>
        <div fxLayout="row" fxLayout.xs="column" fxLayoutWrap fxLayoutGap="0.5%" fxLayoutAlign="center">
          <div>
            <button mat-raised-button color="Basic" (click)="creatProcurationCustomer()">{{procurationCustomer.value.id ? 'تعديل' : 'إضافه'}}</button>
          </div>
          <div>
          <button mat-raised-button color="warn" (click)="clearForm()">مسح</button>
        </div>
        </div>
      </mat-card-actions>
      <mat-card-content>
        <mat-table [dataSource]="(customers$ | async)| customerParticpantType: participantType" class="mat-elevation-z8">
          <!-- Position Column -->
          <ng-container matColumnDef="position">
            <mat-header-cell *matHeaderCellDef> No. </mat-header-cell>
            <mat-cell *matCellDef="let element; let i = index "> {{i+1}} </mat-cell>
          </ng-container>

          <!-- Name Column -->
          <ng-container matColumnDef="customerIdType">
            <mat-header-cell *matHeaderCellDef>نوع الوثيقه </mat-header-cell>
            <mat-cell *matCellDef="let element"> {{element.customer.customerIDType.description}} </mat-cell>
          </ng-container>

          <!-- Weight Column -->
          <ng-container matColumnDef="civilId">
            <mat-header-cell *matHeaderCellDef> الرقم المدني </mat-header-cell>
            <mat-cell *matCellDef="let element"> {{element.customer.customerCivilId}} </mat-cell>
          </ng-container>

          <!-- Symbol Column -->
          <ng-container matColumnDef="nationality">
            <mat-header-cell *matHeaderCellDef> الجنسية </mat-header-cell>
            <mat-cell *matCellDef="let element"> {{element.customer.nationality.description}} </mat-cell>
          </ng-container>
          <ng-container matColumnDef="name">
            <mat-header-cell *matHeaderCellDef>الاسم </mat-header-cell>
            <mat-cell *matCellDef="let element"> {{element.customer.customerName}} </mat-cell>
          </ng-container>
          <ng-container matColumnDef="requestCustomerType">
            <mat-header-cell *matHeaderCellDef>الصفه </mat-header-cell>
            <mat-cell *matCellDef="let element"> {{element.customer.customerCategory.description}} </mat-cell>
          </ng-container>
          <ng-container matColumnDef="mobileNumber">
            <mat-header-cell *matHeaderCellDef>رقم النقال </mat-header-cell>
            <mat-cell *matCellDef="let element"> {{element.customer.mobileNo}} </mat-cell>
          </ng-container>
          <ng-container matColumnDef="moql-qaser-mfwad">
            <mat-header-cell *matHeaderCellDef>موكل/قاصر/مفوض </mat-header-cell>
            <mat-cell *matCellDef="let element"> </mat-cell>
          </ng-container>
          <ng-container matColumnDef="check">
            <mat-header-cell *matHeaderCellDef>تحقق </mat-header-cell>
            <mat-cell *matCellDef="let element">
              <mat-icon matTooltip="عرض" color="primary">remove_red_eye</mat-icon>
            </mat-cell>
          </ng-container>
          <ng-container matColumnDef="edit-delete">
            <mat-header-cell *matHeaderCellDef>تعديل/حذف </mat-header-cell>
            <mat-cell *matCellDef="let element">
              <a mat-icon-button><mat-icon matTooltip="تعديل" color="primary" (click)="fetchProcurationCustomer(element)">edit</mat-icon></a>
              <a mat-icon-button><mat-icon matTooltip="حذف" color="warn" (click)="deleteProcurationCustomer(element.customer.id, element.id)">delete</mat-icon></a>
            </mat-cell>
          </ng-container>

          <mat-header-row *matHeaderRowDef="displayedColumns"></mat-header-row>
          <mat-row *matRowDef="let row; columns: displayedColumns;"></mat-row>
        </mat-table>
      </mat-card-content>
    </mat-card>
  </div>
</div>
